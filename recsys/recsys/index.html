
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../images/icon_no_borders.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>RecSys - ClayRS documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recsys" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ClayRS documentation" class="md-header__button md-logo" aria-label="ClayRS documentation" data-md-component="logo">
      
  <img src="../../images/icon_no_borders.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ClayRS documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RecSys
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/swapUniba/ClayRS" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    swapUniba/ClayRS
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../first_steps/installation/" class="md-tabs__link">
        First steps
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../content_analyzer/introduction/" class="md-tabs__link">
        Content Analyzer
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../introduction/" class="md-tabs__link md-tabs__link--active">
        Recsys
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../evaluation/introduction/" class="md-tabs__link">
        Evaluation
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ClayRS documentation" class="md-nav__button md-logo" aria-label="ClayRS documentation" data-md-component="logo">
      
  <img src="../../images/icon_no_borders.svg" alt="logo">

    </a>
    ClayRS documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/swapUniba/ClayRS" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    swapUniba/ClayRS
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          First steps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="First steps" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          First steps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../first_steps/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../first_steps/quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Content Analyzer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Content Analyzer" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Content Analyzer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../content_analyzer/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../content_analyzer/ratings/" class="md-nav__link">
        Ratings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Recsys
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Recsys" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Recsys
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RecSys
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        RecSys
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS" class="md-nav__link">
    ContentBasedRS
  </a>
  
    <nav class="md-nav" aria-label="ContentBasedRS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.algorithm" class="md-nav__link">
    algorithm()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.fit_predict" class="md-nav__link">
    fit_predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.fit_rank" class="md-nav__link">
    fit_rank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.items_directory" class="md-nav__link">
    items_directory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.rank" class="md-nav__link">
    rank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.users_directory" class="md-nav__link">
    users_directory()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS" class="md-nav__link">
    GraphBasedRS
  </a>
  
    <nav class="md-nav" aria-label="GraphBasedRS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.algorithm" class="md-nav__link">
    algorithm()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.graph" class="md-nav__link">
    graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.rank" class="md-nav__link">
    rank()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.RecSys" class="md-nav__link">
    RecSys
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Evaluation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Evaluation" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Evaluation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/eval_model/" class="md-nav__link">
        EvalModel class
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_3">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/classification_metrics/" class="md-nav__link">
        Classification metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/ranking_metrics/" class="md-nav__link">
        Ranking metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/error_metrics/" class="md-nav__link">
        Error metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/fairness_metrics/" class="md-nav__link">
        Fairness metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/plot_metrics/" class="md-nav__link">
        Plot metrics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Statistical tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Statistical tests" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Statistical tests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/eval_model/" class="md-nav__link">
        Wilcoxon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/eval_model/" class="md-nav__link">
        Ttest
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS" class="md-nav__link">
    ContentBasedRS
  </a>
  
    <nav class="md-nav" aria-label="ContentBasedRS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.algorithm" class="md-nav__link">
    algorithm()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.fit_predict" class="md-nav__link">
    fit_predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.fit_rank" class="md-nav__link">
    fit_rank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.items_directory" class="md-nav__link">
    items_directory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.rank" class="md-nav__link">
    rank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.ContentBasedRS.users_directory" class="md-nav__link">
    users_directory()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS" class="md-nav__link">
    GraphBasedRS
  </a>
  
    <nav class="md-nav" aria-label="GraphBasedRS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.algorithm" class="md-nav__link">
    algorithm()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.graph" class="md-nav__link">
    graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.GraphBasedRS.rank" class="md-nav__link">
    rank()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clayrs.recsys.recsys.RecSys" class="md-nav__link">
    RecSys
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/swapUniba/ClayRS/edit/master/docs/recsys/recsys.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="recsys">Recsys</h1>


<div class="doc doc-object doc-module">



  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="clayrs.recsys.recsys.ContentBasedRS" class="doc doc-heading">
        <code>ContentBasedRS</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="clayrs.recsys.recsys.RecSys" href="#clayrs.recsys.recsys.RecSys">RecSys</a></code></p>

  
      <p>Class for recommender systems which use the items' content in order to make predictions,
some algorithms may also use users' content</p>
<p>Every CBRS differ from each other based the algorithm chosen</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>algorithm</code></td>
          <td>
                <code><span title="clayrs.recsys.content_based_algorithm.content_based_algorithm.ContentBasedAlgorithm">ContentBasedAlgorithm</span></code>
          </td>
          <td><p>the content based algorithm that will be used in order to
rank or make score prediction</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>train_set</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>a DataFrame containing interactions between users and items</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>items_directory</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the path of the items serialized by the Content Analyzer</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>users_directory</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the path of the users serialized by the Content Analyzer</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ContentBasedRS</span><span class="p">(</span><span class="n">RecSys</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for recommender systems which use the items&#39; content in order to make predictions,</span>
<span class="sd">    some algorithms may also use users&#39; content</span>

<span class="sd">    Every CBRS differ from each other based the algorithm chosen</span>

<span class="sd">    Args:</span>
<span class="sd">        algorithm (ContentBasedAlgorithm): the content based algorithm that will be used in order to</span>
<span class="sd">            rank or make score prediction</span>
<span class="sd">        train_set (pd.DataFrame): a DataFrame containing interactions between users and items</span>
<span class="sd">        items_directory (str): the path of the items serialized by the Content Analyzer</span>
<span class="sd">        users_directory (str): the path of the users serialized by the Content Analyzer</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">algorithm</span><span class="p">:</span> <span class="n">ContentBasedAlgorithm</span><span class="p">,</span>
                 <span class="n">train_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span>
                 <span class="n">items_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">users_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__train_set</span> <span class="o">=</span> <span class="n">train_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__items_directory</span> <span class="o">=</span> <span class="n">items_directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__users_directory</span> <span class="o">=</span> <span class="n">users_directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The content based algorithm chosen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alg</span><span class="p">:</span> <span class="n">ContentBasedAlgorithm</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">algorithm</span>
        <span class="k">return</span> <span class="n">alg</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">train_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__train_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Path of the serialized items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__items_directory</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">users_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Path of the serialized users</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__users_directory</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that divides the train set into as many parts as</span>
<span class="sd">        there are different users. then it proceeds with the fit</span>
<span class="sd">        for each user and saves the result in the dictionary &quot;user_fit_dic&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items_to_load</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">item_id_column</span><span class="p">)</span>
        <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="n">items_to_load</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;Fitting algorithm&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">user_alg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
                    <span class="n">user_alg</span><span class="o">.</span><span class="n">process_rated</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">)</span>
                    <span class="n">user_alg</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_alg</span>
                <span class="k">except</span> <span class="n">UserSkipAlgFit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warning_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No algorithm will be fitted for the user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_message</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># we force the garbage collector after freeing loaded items</span>
        <span class="k">del</span> <span class="n">loaded_items_interface</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Rank</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to calculate ranking for the user in test set</span>

<span class="sd">        If the recs_number is specified, then the rank will contain the top-n items for the users.</span>
<span class="sd">        Otherwise the rank will contain all unrated items of the particular users</span>

<span class="sd">        if the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">        score prediction is executed only for the items inside the filter list.</span>
<span class="sd">        Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">        Args:</span>
<span class="sd">            test_set: set of users for which to calculate the rank</span>
<span class="sd">            n_recs: number of the top items that will be present in the ranking</span>

<span class="sd">        Returns:</span>
<span class="sd">            concat_rank: list of the items ranked for each user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFittedAlg</span><span class="p">(</span><span class="s2">&quot;Algorithm not fit! You must call the fit() method first, or fit_rank().&quot;</span><span class="p">)</span>

        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

        <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

        <span class="n">rank</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
                <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

                <span class="n">user_fitted_alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_fitted_alg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">user_rank</span> <span class="o">=</span> <span class="n">user_fitted_alg</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                                     <span class="n">n_recs</span><span class="p">,</span> <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">user_rank</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No algorithm fitted for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">! It will be skipped&quot;</span><span class="p">)</span>

                <span class="n">rank</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_rank</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing rank for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rank</span> <span class="o">=</span> <span class="n">Rank</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span>

        <span class="c1"># we force the garbage collector after freeing loaded items</span>
        <span class="k">del</span> <span class="n">loaded_items_interface</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;n_recs&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n_recs</span><span class="p">),</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">rank</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Prediction</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to call when score prediction must be done for the users in test set</span>

<span class="sd">        If the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">        score prediction is executed only for the items inside the filter list.</span>
<span class="sd">        Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">        Args:</span>
<span class="sd">            test_set: set of users for which to calculate the predictions</span>

<span class="sd">        Returns:</span>
<span class="sd">            concat_score_preds: prediction for each user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFittedAlg</span><span class="p">(</span><span class="s2">&quot;Algorithm not fit! You must call the fit() method first, or fit_rank().&quot;</span><span class="p">)</span>

        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

        <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

                <span class="n">user_fitted_alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_fitted_alg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">user_pred</span> <span class="o">=</span> <span class="n">user_fitted_alg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                                        <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">user_pred</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No algorithm fitted for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">! It will be skipped&quot;</span><span class="p">)</span>

                <span class="n">pred</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_pred</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing predictions for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="n">Prediction</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

        <span class="c1"># we force the garbage collector after freeing loaded items</span>
        <span class="k">del</span> <span class="n">loaded_items_interface</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;score_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">pred</span>

    <span class="k">def</span> <span class="nf">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">(),</span>
                    <span class="n">save_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prediction</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The method fits the algorithm and then calculates the prediction for each user</span>

<span class="sd">        Args:</span>
<span class="sd">            test_set: set of users for which to calculate the prediction</span>

<span class="sd">        Returns:</span>
<span class="sd">            prediction: prediction for each user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

        <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                        <span class="n">user_alg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_alg</span>
                        <span class="n">alg</span> <span class="o">=</span> <span class="n">user_alg</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>

                    <span class="n">alg</span><span class="o">.</span><span class="n">process_rated</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">)</span>

                    <span class="n">alg</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

                <span class="k">except</span> <span class="n">UserSkipAlgFit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warning_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The algorithm can&#39;t be fitted for the user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_message</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">continue</span>

                <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

                <span class="n">user_pred</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                        <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>

                <span class="n">pred</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_pred</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing fit_rank for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="n">Prediction</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

        <span class="c1"># we force the garbage collector after freeing loaded items</span>
        <span class="k">del</span> <span class="n">loaded_items_interface</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;score_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">pred</span>

    <span class="k">def</span> <span class="nf">fit_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">(),</span>
                 <span class="n">save_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rank</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The method fits the algorithm and then calculates the rank for each user</span>

<span class="sd">        Args:</span>
<span class="sd">            test_set: set of users for which to calculate the rank</span>
<span class="sd">            n_recs: number of the top items that will be present in the ranking</span>

<span class="sd">        Returns:</span>
<span class="sd">            rank: ranked items for each user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

        <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

        <span class="n">rank</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                        <span class="n">user_alg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_alg</span>
                        <span class="n">alg</span> <span class="o">=</span> <span class="n">user_alg</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>

                    <span class="n">alg</span><span class="o">.</span><span class="n">process_rated</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">)</span>

                    <span class="n">alg</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

                <span class="k">except</span> <span class="n">UserSkipAlgFit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warning_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The algorithm can&#39;t be fitted for the user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_message</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">continue</span>

                <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

                <span class="n">user_rank</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                     <span class="n">n_recs</span><span class="p">,</span> <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>

                <span class="n">rank</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_rank</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing fit_rank for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rank</span> <span class="o">=</span> <span class="n">Rank</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span>

        <span class="c1"># we force the garbage collector after freeing loaded items</span>
        <span class="k">del</span> <span class="n">loaded_items_interface</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;n_recs&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n_recs</span><span class="p">),</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">rank</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ContentBasedRS(algorithm=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">, train_set=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="si">}</span><span class="s2">, &quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;items_directory=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="si">}</span><span class="s2">, users_directory=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">users_directory</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.algorithm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">algorithm</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The content based algorithm chosen</p>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The content based algorithm chosen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alg</span><span class="p">:</span> <span class="n">ContentBasedAlgorithm</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">algorithm</span>
    <span class="k">return</span> <span class="n">alg</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.fit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Method that divides the train set into as many parts as
there are different users. then it proceeds with the fit
for each user and saves the result in the dictionary "user_fit_dic"</p>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that divides the train set into as many parts as</span>
<span class="sd">    there are different users. then it proceeds with the fit</span>
<span class="sd">    for each user and saves the result in the dictionary &quot;user_fit_dic&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items_to_load</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">item_id_column</span><span class="p">)</span>
    <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="n">items_to_load</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;Fitting algorithm&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">user_alg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
                <span class="n">user_alg</span><span class="o">.</span><span class="n">process_rated</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">)</span>
                <span class="n">user_alg</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_alg</span>
            <span class="k">except</span> <span class="n">UserSkipAlgFit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warning_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No algorithm will be fitted for the user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># we force the garbage collector after freeing loaded items</span>
    <span class="k">del</span> <span class="n">loaded_items_interface</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.fit_predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_predict</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">user_id_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methodology</span><span class="o">=</span><span class="n">TestRatingsMethodology</span><span class="p">(),</span> <span class="n">save_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The method fits the algorithm and then calculates the prediction for each user</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>test_set</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="clayrs.content_analyzer.Ratings" href="../../content_analyzer/ratings/#clayrs.content_analyzer.ratings_manager.ratings.Ratings">Ratings</a></code>
          </td>
          <td><p>set of users for which to calculate the prediction</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>prediction</code></td>          <td>
                <code><span title="clayrs.content_analyzer.ratings_manager.ratings.Prediction">Prediction</span></code>
          </td>
          <td><p>prediction for each user</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">(),</span>
                <span class="n">save_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prediction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The method fits the algorithm and then calculates the prediction for each user</span>

<span class="sd">    Args:</span>
<span class="sd">        test_set: set of users for which to calculate the prediction</span>

<span class="sd">    Returns:</span>
<span class="sd">        prediction: prediction for each user</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

    <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                    <span class="n">user_alg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_alg</span>
                    <span class="n">alg</span> <span class="o">=</span> <span class="n">user_alg</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>

                <span class="n">alg</span><span class="o">.</span><span class="n">process_rated</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">)</span>

                <span class="n">alg</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

            <span class="k">except</span> <span class="n">UserSkipAlgFit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warning_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The algorithm can&#39;t be fitted for the user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_message</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>

            <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

            <span class="n">user_pred</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                    <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>

            <span class="n">pred</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_pred</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing fit_rank for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="n">Prediction</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="c1"># we force the garbage collector after freeing loaded items</span>
    <span class="k">del</span> <span class="n">loaded_items_interface</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;score_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">pred</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.fit_rank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_rank</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">n_recs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methodology</span><span class="o">=</span><span class="n">TestRatingsMethodology</span><span class="p">(),</span> <span class="n">save_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>The method fits the algorithm and then calculates the rank for each user</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>test_set</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="clayrs.content_analyzer.Ratings" href="../../content_analyzer/ratings/#clayrs.content_analyzer.ratings_manager.ratings.Ratings">Ratings</a></code>
          </td>
          <td><p>set of users for which to calculate the rank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_recs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of the top items that will be present in the ranking</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>rank</code></td>          <td>
                <code><span title="clayrs.content_analyzer.ratings_manager.ratings.Rank">Rank</span></code>
          </td>
          <td><p>ranked items for each user</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">(),</span>
             <span class="n">save_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rank</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The method fits the algorithm and then calculates the rank for each user</span>

<span class="sd">    Args:</span>
<span class="sd">        test_set: set of users for which to calculate the rank</span>
<span class="sd">        n_recs: number of the top items that will be present in the ranking</span>

<span class="sd">    Returns:</span>
<span class="sd">        rank: ranked items for each user</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

    <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                    <span class="n">user_alg</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_alg</span>
                    <span class="n">alg</span> <span class="o">=</span> <span class="n">user_alg</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>

                <span class="n">alg</span><span class="o">.</span><span class="n">process_rated</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">)</span>

                <span class="n">alg</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

            <span class="k">except</span> <span class="n">UserSkipAlgFit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warning_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The algorithm can&#39;t be fitted for the user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning_message</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">save_fit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>

            <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

            <span class="n">user_rank</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                 <span class="n">n_recs</span><span class="p">,</span> <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>

            <span class="n">rank</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_rank</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing fit_rank for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">Rank</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span>

    <span class="c1"># we force the garbage collector after freeing loaded items</span>
    <span class="k">del</span> <span class="n">loaded_items_interface</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;n_recs&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n_recs</span><span class="p">),</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">rank</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.items_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">items_directory</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path of the serialized items</p>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">items_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Path of the serialized items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__items_directory</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">user_id_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methodology</span><span class="o">=</span><span class="n">TestRatingsMethodology</span><span class="p">())</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Method to call when score prediction must be done for the users in test set</p>
<p>If the items evaluated are present for each user, the filter list is calculated, and
score prediction is executed only for the items inside the filter list.
Otherwise, score prediction is executed for all unrated items of the particular user</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>test_set</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="clayrs.content_analyzer.Ratings" href="../../content_analyzer/ratings/#clayrs.content_analyzer.ratings_manager.ratings.Ratings">Ratings</a></code>
          </td>
          <td><p>set of users for which to calculate the predictions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>concat_score_preds</code></td>          <td>
                <code><span title="clayrs.content_analyzer.ratings_manager.ratings.Prediction">Prediction</span></code>
          </td>
          <td><p>prediction for each user</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Prediction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to call when score prediction must be done for the users in test set</span>

<span class="sd">    If the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">    score prediction is executed only for the items inside the filter list.</span>
<span class="sd">    Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">    Args:</span>
<span class="sd">        test_set: set of users for which to calculate the predictions</span>

<span class="sd">    Returns:</span>
<span class="sd">        concat_score_preds: prediction for each user</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotFittedAlg</span><span class="p">(</span><span class="s2">&quot;Algorithm not fit! You must call the fit() method first, or fit_rank().&quot;</span><span class="p">)</span>

    <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

    <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

            <span class="n">user_fitted_alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_fitted_alg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">user_pred</span> <span class="o">=</span> <span class="n">user_fitted_alg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                                    <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">user_pred</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No algorithm fitted for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">! It will be skipped&quot;</span><span class="p">)</span>

            <span class="n">pred</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_pred</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing predictions for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="n">Prediction</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="c1"># we force the garbage collector after freeing loaded items</span>
    <span class="k">del</span> <span class="n">loaded_items_interface</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;score_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">pred</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.rank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rank</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">n_recs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methodology</span><span class="o">=</span><span class="n">TestRatingsMethodology</span><span class="p">())</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Method used to calculate ranking for the user in test set</p>
<p>If the recs_number is specified, then the rank will contain the top-n items for the users.
Otherwise the rank will contain all unrated items of the particular users</p>
<p>if the items evaluated are present for each user, the filter list is calculated, and
score prediction is executed only for the items inside the filter list.
Otherwise, score prediction is executed for all unrated items of the particular user</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>test_set</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="clayrs.content_analyzer.Ratings" href="../../content_analyzer/ratings/#clayrs.content_analyzer.ratings_manager.ratings.Ratings">Ratings</a></code>
          </td>
          <td><p>set of users for which to calculate the rank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_recs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of the top items that will be present in the ranking</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>concat_rank</code></td>          <td>
                <code><span title="clayrs.content_analyzer.ratings_manager.ratings.Rank">Rank</span></code>
          </td>
          <td><p>list of the items ranked for each user</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Rank</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to calculate ranking for the user in test set</span>

<span class="sd">    If the recs_number is specified, then the rank will contain the top-n items for the users.</span>
<span class="sd">    Otherwise the rank will contain all unrated items of the particular users</span>

<span class="sd">    if the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">    score prediction is executed only for the items inside the filter list.</span>
<span class="sd">    Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">    Args:</span>
<span class="sd">        test_set: set of users for which to calculate the rank</span>
<span class="sd">        n_recs: number of the top items that will be present in the ranking</span>

<span class="sd">    Returns:</span>
<span class="sd">        concat_rank: list of the items ranked for each user</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotFittedAlg</span><span class="p">(</span><span class="s2">&quot;Algorithm not fit! You must call the fit() method first, or fit_rank().&quot;</span><span class="p">)</span>

    <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

    <span class="n">loaded_items_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">_load_available_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items_directory</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Don&#39;t worry if it looks stuck at first&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First iterations will stabilize the estimated remaining time&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">get_progbar</span><span class="p">(</span><span class="n">all_users</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>

        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading first items from memory...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
            <span class="n">user_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">get_user_interactions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="n">filter_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methodology</span><span class="o">.</span><span class="n">filter_single</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>

            <span class="n">user_fitted_alg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_fit_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_fitted_alg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">user_rank</span> <span class="o">=</span> <span class="n">user_fitted_alg</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">user_train</span><span class="p">,</span> <span class="n">loaded_items_interface</span><span class="p">,</span>
                                                 <span class="n">n_recs</span><span class="p">,</span> <span class="n">filter_list</span><span class="o">=</span><span class="n">filter_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">user_rank</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No algorithm fitted for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">! It will be skipped&quot;</span><span class="p">)</span>

            <span class="n">rank</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">user_rank</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing rank for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">Rank</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span>

    <span class="c1"># we force the garbage collector after freeing loaded items</span>
    <span class="k">del</span> <span class="n">loaded_items_interface</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;n_recs&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n_recs</span><span class="p">),</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">rank</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.ContentBasedRS.users_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">users_directory</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path of the serialized users</p>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">users_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Path of the serialized users</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__users_directory</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clayrs.recsys.recsys.GraphBasedRS" class="doc doc-heading">
        <code>GraphBasedRS</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="clayrs.recsys.recsys.RecSys" href="#clayrs.recsys.recsys.RecSys">RecSys</a></code></p>

  
      <p>Class for recommender systems which use a graph in order to make predictions</p>
<p>Every graph based recommender system differ from each other based the algorithm chosen</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>algorithm</code></td>
          <td>
                <code><span title="clayrs.recsys.graph_based_algorithm.graph_based_algorithm.GraphBasedAlgorithm">GraphBasedAlgorithm</span></code>
          </td>
          <td><p>the graph based algorithm that will be used in order to
rank or make score prediction</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>graph</code></td>
          <td>
                <code>FullGraph</code>
          </td>
          <td><p>a FullGraph containing interactions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GraphBasedRS</span><span class="p">(</span><span class="n">RecSys</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for recommender systems which use a graph in order to make predictions</span>

<span class="sd">    Every graph based recommender system differ from each other based the algorithm chosen</span>

<span class="sd">    Args:</span>
<span class="sd">        algorithm (GraphBasedAlgorithm): the graph based algorithm that will be used in order to</span>
<span class="sd">            rank or make score prediction</span>
<span class="sd">        graph (FullGraph): a FullGraph containing interactions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">algorithm</span><span class="p">:</span> <span class="n">GraphBasedAlgorithm</span><span class="p">,</span>
                 <span class="n">graph</span><span class="p">:</span> <span class="n">FullDiGraph</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span><span class="o">.</span><span class="n">user_nodes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The graph containing interactions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The content based algorithm chosen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alg</span><span class="p">:</span> <span class="n">GraphBasedAlgorithm</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">algorithm</span>
        <span class="k">return</span> <span class="n">alg</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to predict the rating of the users</span>

<span class="sd">        If the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">        score prediction is executed only for the items inside the filter list.</span>
<span class="sd">        Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">        Args:</span>
<span class="sd">            test_set: set of users for which to calculate the predictions</span>

<span class="sd">        Returns:</span>
<span class="sd">            concate_score_preds: list of predictions for each user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

        <span class="n">filter_dict</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">train_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">to_ratings</span><span class="p">()</span>
            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">methodology</span><span class="o">.</span><span class="n">filter_all</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">,</span> <span class="n">result_as_iter_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">total_predict_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">all_users</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">)</span>

        <span class="n">total_predict</span> <span class="o">=</span> <span class="n">Prediction</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">total_predict_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graph&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">),</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;score_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">total_predict</span>

    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to rank the rating of the users</span>

<span class="sd">        If the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">        score prediction is executed only for the items inside the filter list.</span>
<span class="sd">        Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">        Args:</span>
<span class="sd">            test_set:  set of users for which to calculate the rank</span>
<span class="sd">            n_recs:  number of the top items that will be present in the ranking</span>

<span class="sd">        Returns:</span>
<span class="sd">            concate_rank: list of the items ranked for each user</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

        <span class="n">filter_dict</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">train_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">to_ratings</span><span class="p">()</span>
            <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">methodology</span><span class="o">.</span><span class="n">filter_all</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">,</span> <span class="n">result_as_iter_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">total_rank_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">all_users</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">)</span>

        <span class="n">total_rank</span> <span class="o">=</span> <span class="n">Rank</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">total_rank_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_rank</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No items could be ranked for any users! Remember that items to rank must be present &quot;</span>
                           <span class="s2">&quot;in the graph.</span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="s2">&quot;Try changing methodology!&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">total_rank</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_users</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No items could be ranked for users </span><span class="si">{</span><span class="n">all_users</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">total_rank</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;No nodes to rank for them found in the graph. Try changing methodology! &quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graph&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">),</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;n_recs&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n_recs</span><span class="p">),</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">total_rank</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;GraphBasedRS(algorithm=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">, graph=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.GraphBasedRS.algorithm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">algorithm</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The content based algorithm chosen</p>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The content based algorithm chosen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alg</span><span class="p">:</span> <span class="n">GraphBasedAlgorithm</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">algorithm</span>
    <span class="k">return</span> <span class="n">alg</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.GraphBasedRS.graph" class="doc doc-heading">
<code class="highlight language-python"><span class="n">graph</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The graph containing interactions</p>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The graph containing interactions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__graph</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.GraphBasedRS.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">user_id_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methodology</span><span class="o">=</span><span class="n">TestRatingsMethodology</span><span class="p">())</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Method used to predict the rating of the users</p>
<p>If the items evaluated are present for each user, the filter list is calculated, and
score prediction is executed only for the items inside the filter list.
Otherwise, score prediction is executed for all unrated items of the particular user</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>test_set</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="clayrs.content_analyzer.Ratings" href="../../content_analyzer/ratings/#clayrs.content_analyzer.ratings_manager.ratings.Ratings">Ratings</a></code>
          </td>
          <td><p>set of users for which to calculate the predictions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>concate_score_preds</code></td>          <td>
          </td>
          <td><p>list of predictions for each user</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to predict the rating of the users</span>

<span class="sd">    If the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">    score prediction is executed only for the items inside the filter list.</span>
<span class="sd">    Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">    Args:</span>
<span class="sd">        test_set: set of users for which to calculate the predictions</span>

<span class="sd">    Returns:</span>
<span class="sd">        concate_score_preds: list of predictions for each user</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

    <span class="n">filter_dict</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">to_ratings</span><span class="p">()</span>
        <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">methodology</span><span class="o">.</span><span class="n">filter_all</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">,</span> <span class="n">result_as_iter_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">total_predict_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">all_users</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">)</span>

    <span class="n">total_predict</span> <span class="o">=</span> <span class="n">Prediction</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">total_predict_list</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graph&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">),</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;score_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">total_predict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="clayrs.recsys.recsys.GraphBasedRS.rank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rank</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">n_recs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">methodology</span><span class="o">=</span><span class="n">TestRatingsMethodology</span><span class="p">())</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Method used to rank the rating of the users</p>
<p>If the items evaluated are present for each user, the filter list is calculated, and
score prediction is executed only for the items inside the filter list.
Otherwise, score prediction is executed for all unrated items of the particular user</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>test_set</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="clayrs.content_analyzer.Ratings" href="../../content_analyzer/ratings/#clayrs.content_analyzer.ratings_manager.ratings.Ratings">Ratings</a></code>
          </td>
          <td><p>set of users for which to calculate the rank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_recs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of the top items that will be present in the ranking</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>concate_rank</code></td>          <td>
          </td>
          <td><p>list of the items ranked for each user</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">Ratings</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">methodology</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Methodology</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestRatingsMethodology</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method used to rank the rating of the users</span>

<span class="sd">    If the items evaluated are present for each user, the filter list is calculated, and</span>
<span class="sd">    score prediction is executed only for the items inside the filter list.</span>
<span class="sd">    Otherwise, score prediction is executed for all unrated items of the particular user</span>

<span class="sd">    Args:</span>
<span class="sd">        test_set:  set of users for which to calculate the rank</span>
<span class="sd">        n_recs:  number of the top items that will be present in the ranking</span>

<span class="sd">    Returns:</span>
<span class="sd">        concate_rank: list of the items ranked for each user</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_id_list</span><span class="p">)</span>

    <span class="n">filter_dict</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">methodology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">train_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">to_ratings</span><span class="p">()</span>
        <span class="n">filter_dict</span> <span class="o">=</span> <span class="n">methodology</span><span class="o">.</span><span class="n">filter_all</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">,</span> <span class="n">result_as_iter_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">total_rank_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">all_users</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">)</span>

    <span class="n">total_rank</span> <span class="o">=</span> <span class="n">Rank</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">total_rank_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_rank</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No items could be ranked for any users! Remember that items to rank must be present &quot;</span>
                       <span class="s2">&quot;in the graph.</span><span class="se">\n</span><span class="s2">&quot;</span>
                       <span class="s2">&quot;Try changing methodology!&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">total_rank</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_users</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No items could be ranked for users </span><span class="si">{</span><span class="n">all_users</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">total_rank</span><span class="o">.</span><span class="n">user_id_column</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                       <span class="sa">f</span><span class="s2">&quot;No nodes to rank for them found in the graph. Try changing methodology! &quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graph&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">),</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;n_recs&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n_recs</span><span class="p">),</span> <span class="s1">&#39;methodology&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">methodology</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">total_rank</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="clayrs.recsys.recsys.RecSys" class="doc doc-heading">
        <code>RecSys</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Abstract class for a Recommender System</p>
<p>There exists various type of recommender systems, content-based, graph-based, etc. so extend this class
if another type must be implemented into the framework.</p>
<p>Every recommender system do its prediction based on a rating frame, containing interactions between
users and items</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>rating_frame</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>a dataframe containing interactions between users and items</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>clayrs/recsys/recsys.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RecSys</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for a Recommender System</span>

<span class="sd">    There exists various type of recommender systems, content-based, graph-based, etc. so extend this class</span>
<span class="sd">    if another type must be implemented into the framework.</span>

<span class="sd">    Every recommender system do its prediction based on a rating frame, containing interactions between</span>
<span class="sd">    users and items</span>

<span class="sd">    Args:</span>
<span class="sd">        rating_frame (pd.DataFrame): a dataframe containing interactions between users and items</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ContentBasedAlgorithm</span><span class="p">,</span> <span class="n">GraphBasedAlgorithm</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__alg</span> <span class="o">=</span> <span class="n">algorithm</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_yaml_report</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__alg</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">n_recs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rank</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Prediction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../introduction/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../../evaluation/introduction/" class="md-footer__link md-footer__link--next" aria-label="Next: Introduction" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Introduction
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tooltips", "navigation.tabs", "navigation.sections", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>